---
title: "GroupProject"
output: html_document
html_document:
    toc: true
    toc_depth: 2
---

import libraries
```{r}
library(dplyr)
library(tidyverse)
library(xlsx)
library(reshape2)
library(gridExtra)
```

loading data
```{r}
setwd("C:\\Users\\Baris\\Desktop\\Big Data Analytics MEF 2018-2019\\TERM1\\Data Anaytics Essential\\Grup Projesi")
```


```{r}

df <- read.xlsx("data.xlsx", 1 , stringsAsFactors = FALSE)
```

Looking first glance at data

```{r}
head(df)
```

A summarise data structure

```{r}
df %>% summarise_at(names(df), mean, na.rm = TRUE) 
  
  
```



```{r}
df %>%
  group_by(Dates) %>%
  summarise_all(mean)


```



```{r}
df %>%
  group_by(Dates) %>%
  summarise_all(c("min", "max"))
  
  
```


An example from data to look:

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = GARAN_Price * GARAN_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates)) + geom_bar(stat = "identity")
```



```{r}
df %>% group_by(Dates) %>% summarise_all(funs(mean))
```

## Data Wrangling 


```{r}
namesTable <- names(df)
```




```{r}

volumeNames <- namesTable[grepl('Volume$', namesTable)]
priceNames <- namesTable[grepl('Price$', namesTable)]

 


```


```{r}
df_volume <- df %>% summarise_at(names(df), mean, na.rm = TRUE) %>%
  select(matches("Volume")) 

df_volume

```

```{r}
volumes <- as.data.frame(t(df_volume))

```

```{r}
volumeTable <-melt(data.frame(volumeNames ,volumes))
volumeTable$variable <- NULL
volumeTable 
```



```{r}
df_volume <- df %>% summarise_at(names(df), mean, na.rm = TRUE) %>%
  select(matches("price")) 

prices <- as.data.frame(t(df_volume))
```
```{r}

pricesTable <- melt(data.frame(priceNames ,prices))
pricesTable$variable <- NULL
pricesTable
```


After collecting prices and volumes as a two catogories, we can look at these data for patterns.


## Visualization

### Volume Values


Highest values in volume table.(First five)

```{r}
v1 <- volumeTable %>% filter(value > 36500000) %>%
  arrange(value) %>% ggplot(data = ., aes(x = volumeNames, y = value, 
    fill = value)) + geom_bar(stat = "identity")
v1
```

Lowest values in volume table.(Last Five)
```{r}
v2 <- volumeTable %>% filter(value < 1200000) %>%
  arrange(value) %>% ggplot(data = ., aes(x = volumeNames, y = value, 
    fill = value)) + geom_bar(stat = "identity")
v2
```

```{r}
grid.arrange(v1, 
             v2, 
             ncol=2)
```

## Highest First 5 Volume Graphics by Date

First is GARAN. The average weighted changes at GARAN Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = GARAN_Price * GARAN_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'darkblue')
```

Second is KRDMD The average weighted changes at KRDMD Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = KRDMD_Price * KRDMD_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates,)) + geom_line( color = 'darkblue')
```

Third is THYAO average weighted changes at THYAO Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = THYAO_Price * THYAO_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates,)) + geom_line( color = 'darkblue')
```


Forth is YKBNK average weighted changes at YKBNK Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = YKBNK._Price * YKBNK._Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates,)) + geom_line( color = 'darkblue')
```

Fifth is EKGYO average weighted changes at EKGYO Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = EKGYO_Price * EKGYO_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates,)) + geom_line( color = 'darkblue')
```


## Lowest Last 5 Volume Graphics by Date


Last is TTRAK. The average weighted changes at TTRAK. Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = TTRAK_Price * TTRAK_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'darkblue')
```


Second Last is BIMAS The average weighted changes at BIMAS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = BIMAS_Price * BIMAS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'darkblue')
```

Third Last is MGROS The average weighted changes at MGROS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = MGROS_Price * MGROS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'darkblue')
```

Forth Last is TOASO The average weighted changes at TOASO Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = TOASO_Price * TOASO_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'darkblue')
```

Fifth Last is TUPRS The average weighted changes at TUPRS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = TUPRS_Price * TUPRS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'darkblue')
```

### Price Values

Highest 5 prices in stock market.

```{r}
p1 <- pricesTable %>% filter(value > 20) %>%
  arrange(value) %>% ggplot(data = ., aes(x = priceNames, y = value, 
    fill = value)) + geom_bar(stat = "identity")
p1
```

Lowest 5 prices in stock market.

```{r}
p2 <- pricesTable %>% filter(value < 2.635) %>%
  arrange(value) %>% ggplot(data = ., aes(x = priceNames, y = value, 
    fill = value)) + geom_bar(stat = "identity")
p2
```

```{r}
grid.arrange(p1, 
             p2, 
             ncol=2)
```

## Highest First 5 Price Graphics by Date

First is TUPRS The average weighted changes at TUPRS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = TUPRS_Price * TUPRS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```


Second is TTRAK The average weighted changes at TTRAK Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = TTRAK_Price * TTRAK_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Third is BIMAS The average weighted changes at BIMAS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = BIMAS_Price * BIMAS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Forth is KOZAL The average weighted changes at KOZAL Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = KOZAL_Price * KOZAL_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Fifth is MGROS The average weighted changes at MGROS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = MGROS_Price * MGROS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

## Lowest Last 5 Price Graphics by Date

Last is IHLAS The average weighted changes at IHLAS Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = IHLAS_Price * IHLAS_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Second last is DOHOL The average weighted changes at DOHOL Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = DOHOL_Price * DOHOL_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Third last is ASYAB The average weighted changes at ASYAB Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = ASYAB_Price * ASYAB_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Fourth last is KRDMD The average weighted changes at KRDMD Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = KRDMD_Price * KRDMD_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```

Fifth last is EKGYO The average weighted changes at EKGYO Comp.

```{r}
df %>%
  group_by(Dates) %>%
  mutate(weightedAvg = EKGYO_Price * EKGYO_Volume) %>%
  ggplot(data = ., aes(x = Dates, y = weightedAvg, 
    fill = Dates, color = Dates)) + geom_line(color = 'chocolate1')
```


## Correlation of Volume and Price

```{r}
cor(volumeTable$value,pricesTable$value)
```

## General Values of Weighted Averages

Creating a total company name list

```{r}
companyNames <- c('GARAN','SAHOL','BIMAS','ARCLK','EREGL','YKBNK','TOASO','TUPRS','KRDMD','TTRAK','ASELS','IPEKE','KOZAA','ASYAB','ENKAI','KOZAL','DOHOL','IHLAS','KCHOL','EKGYO','TCELL','MGROS','SISE','ISCTR','VAKBN','AKBNK','PETKM','THYAO','TTKOM','HALKB')
length(companyNames)
```

Merging the volumes and prices

```{r}
weightedPrices <- pricesTable$value * volumeTable$value
generalTable <- melt(data.frame(companyNames ,weightedPrices))
generalTable$variable <- NULL

```

```{r}
generalTable %>%
  arrange(desc(value)) %>%
  ggplot(data = ., aes(x = companyNames, y = value, 
    fill = companyNames, color = companyNames)) + geom_bar(stat = 'identity') 
``` 



